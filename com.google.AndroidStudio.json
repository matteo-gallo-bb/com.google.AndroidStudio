{
    "app-id": "com.google.AndroidStudio",
    "runtime": "org.freedesktop.Sdk",
    "runtime-version": "21.08",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions": ["org.freedesktop.Sdk.Extension.openjdk11"],
    "command": "studio",
    "finish-args": [
        "--socket=x11",
        "--socket=ssh-auth",
        "--share=network",
        "--share=ipc",
        "--device=all",
        "--filesystem=~/android-rebuilds:ro",
        "--filesystem=xdg-cache/tmp:create",
        "--filesystem=xdg-cache/log:create",
        "--filesystem=xdg-data/emulator:create",
        "--filesystem=xdg-data/emulator/avd:create",
        "--filesystem=xdg-data/gradle:create",
        "--filesystem=xdg-data/plugins:create",
        "--filesystem=xdg-data/system:create",
        "--filesystem=xdg-data/config:create",
        "--filesystem=xdg-run/keyring",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.secrets"
    ],
    "modules": [
        {
           "name" : "openjdk11",
           "buildsystem" : "simple",
           "build-commands" : [ "/usr/lib/sdk/openjdk11/installjdk.sh" ]
        },
        {
            "name": "android-studio",
            "buildsystem": "simple",
            "build-commands": [
                "install --mode=0755 --directory /app/android-studio/",
                "cp -r android-studio/* /app/android-studio/",
                "install -D --mode=0644 /app/android-studio/bin/studio.svg /app/share/icons/hicolor/scalable/apps/com.google.AndroidStudio.svg",
                "install -D --mode=0755 studio --target-directory=/app/bin/",
                "install -D --mode=0644 studio.properties --target-directory=/app/bin/",
                "install -D --mode=0644 com.google.AndroidStudio.appdata.xml --target-directory=/app/share/appdata/",
                "install -D --mode=0644 com.google.AndroidStudio.desktop --target-directory=/app/share/applications/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "dest-filename": "android-studio.tar.gz",
                    "dest": "android-studio",
                    "only-arches": [
                        "x86_64"
                    ],
                    "url": "https://dl.google.com/dl/android/studio/ide-zips/2020.3.1.24/android-studio-2020.3.1.24-linux.tar.gz",
                    "sha256": "f498ac0446b1fe32d9d5dda2b508049eb6732d9499619e2adf5ec9bb1166124d",
                    "archive-type": "tar-gzip"
                },
                {
                    "type": "script",
                    "dest-filename": "studio",
                    "commands": [
                        "export JAVA_HOME=/app/jdk",
                        "export JAVA_TOOL_OPTIONS=-Djava.io.tmpdir=${XDG_CACHE_HOME}/tmp",
                        "export STUDIO_GRADLE_JDK=/app/jdk",
                        "export GRADLE_USER_HOME=${XDG_DATA_HOME}/gradle",
                        "export ANDROID_SDK_ROOT=~/android-rebuilds",
                        "export TMPDIR=${XDG_RUNTIME_DIR}/app/${FLATPAK_ID}",
                        "export ANDROID_EMULATOR_HOME=${XDG_DATA_HOME}/emulator",
                        "export ANDROID_EMULATOR_USE_SYSTEM_LIBS=1",
                        "export ANDROID_AVD_HOME=${XDG_DATA_HOME}/emulator/avd",
                        "export STUDIO_PROPERTIES=/app/bin/studio.properties",
                        "exec env /app/android-studio/bin/studio.sh \"$@\""
                    ]
                },
                {
                    "type": "file",
                    "path": "studio.properties"
                },
                {
                    "type": "file",
                    "path": "com.google.AndroidStudio.desktop"
                },
                {
                    "type": "file",
                    "path": "com.google.AndroidStudio.appdata.xml"
                }
            ]
        },
        "shared-modules/libsecret/libsecret.json"
    ]
}
